<!DOCTYPE html>
<html>
  <head>
    <title>JCUP</title>
    <meta charset="utf-8" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-3 mb-3" style="width: 450px">
      <h2 class="text-center">JCUP</h2>
      <p class="text-center">Automatic Crypto Subscription Manager</p>
      <form class="form-horizontal">
        <div class="input-group mb-2">
          <label for="currency" class="col-3 align-self-center"
            >Currency:</label
          >
          <div class="col-8">
            <select class="form-control" id="currency" name="currency">
              <option value="USD">BTC</option>
              <option value="EUR">ETH</option>
              <option value="GBP">XRP</option>
            </select>
          </div>
        </div>
        <div class="input-group mb-2">
          <label for="price" class="col-3 align-self-center">Price:</label>
          <div class="col-8">
            <input
              type="number"
              class="form-control"
              id="price"
              name="price"
              step="0.01"
              min="0.00"
              placeholder="0.00"
              required
            />
          </div>
        </div>
        <div class="input-group mb-2">
          <label for="period" class="col-3 align-self-center">Period:</label>
          <div class="col-8">
            <select class="form-control" id="period" name="period">
              <option value="day">Daily</option>
              <option value="week">Weekly</option>
              <option value="month">Monthly</option>
              <option value="year">Yearly</option>
            </select>
          </div>
        </div>
        <button id="submitButton" type="submit" class="btn btn-primary">
          Submit
        </button>
      </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@superfluid-finance/js-sdk@1.13.0/dist/umd/superfluid.min.js"></script>
    <script>
      // Function to set up Superfluid
      async function setupSuperfluid(e) {
        e.preventDefault();

        const web3 = new Web3(window.ethereum);

        // Request account access if needed
        await window.ethereum.enable();

        const sf = new SuperfluidSDK.Framework({ web3 });

        await sf.initialize();

        const payerAddress = (await web3.eth.getAccounts())[0]; // Use the first account
        const payeeAddress = "PAYEE_WALLET_ADDRESS";

        const agreement = await sf.cfa.createFlow({
          superToken: "0xF2d68898557cCb2Cf4C10c3Ef2B034b2a69DAD00", // fDAI token address
          sender: payerAddress,
          receiver: payeeAddress,
          flowRate: "1000000000000000", // Example flow rate of 1 fDAI per second
        });

        console.log("Superfluid agreement created:", agreement);
      }

      document.getElementById("submitButton").addEventListener("click", (e) => {
        setupSuperfluid(e).catch(console.error);
      });
    </script>
  </body>
</html>
